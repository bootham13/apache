trigger:
- master

pool:
  vmImage: 'ubuntu-16.04'

steps:

- task: DownloadSecureFile@1
  name: myInstanceKey
  displayName: 'Download - VM Instance SSH Key'
  inputs:
    secureFile: 'vm-instance-key.pem'

- script: |
    echo "First pipeline script"

- script: |
    echo "Writing $(myChefPem.secureFilePath) to the .chef directory"
    mkdir .chef
    sudo ln -s $(myChefPem.secureFilePath) .chef/chefPem
    ls -la .chef/
  displayName: 'Writing Chef pem file'

- script: |
    echo "Writing $(myInstanceKey.secureFilePath) to the .chef directory"
    sudo ln -s $(myInstanceKey.secureFilePath) .chef/vmInstanceKey
    ls -la .chef/
  displayName: 'Writing VM Instance SSH Key'

- script: |
   /opt/chef-workstation/bin/chef exec cookstyle . --except Layout/EndOfLine 
 displayName: 'Run Cookstyle'
